<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <title>360 Panorama</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    }
    #container { width: 100%; height: 100%; }
    #error {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      background: rgba(0,0,0,0.85);
      color: #fff;
      font-size: 14px;
      line-height: 1.5;
    }
    #error code {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div id="container"></div>

  <div id="error">
    <div>
      <b>Panoraamaa ei voitu ladata</b><br><br>
      Varmista että:<br>
      – Kuva on nimeltään <code>panorama.jpg</code><br>
      – Kuva on samassa kansiossa kuin <code>index.html</code><br>
      – Kuva on equirectangular (2:1)<br>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    const container = document.getElementById('container');
    const errorBox = document.getElementById('error');

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);

    // ✅ IMPORTANT: correct gamma/output so JPEG (sRGB) won't look too dark
    renderer.outputEncoding = THREE.sRGBEncoding;

    container.appendChild(renderer.domElement);

    // Scene & camera
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1100);
    camera.position.set(0, 0, 0.1);

    // Controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableZoom = true;
    controls.enablePan = false;
    controls.rotateSpeed = 0.35;
    controls.minDistance = 0.1;
    controls.maxDistance = 10;

    // Geometry
    const geometry = new THREE.SphereGeometry(500, 60, 40);
    geometry.scale(-1, 1, 1);

    // Material
    const material = new THREE.MeshBasicMaterial({ color: 0x222222 });
    const sphere = new THREE.Mesh(geometry, material);
    scene.add(sphere);

    // Load texture
    const loader = new THREE.TextureLoader();
    loader.load(
      'panorama.jpg',
      function (texture) {
        // ✅ IMPORTANT: tell three.js the texture is sRGB (typical JPEG)
        texture.encoding = THREE.sRGBEncoding;

        texture.minFilter = THREE.LinearFilter;
        sphere.material.map = texture;
        sphere.material.needsUpdate = true;
      },
      undefined,
      function () {
        errorBox.style.display = 'flex';
      }
    );

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Animate
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
